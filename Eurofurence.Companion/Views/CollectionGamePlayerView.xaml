<Page x:Class="Eurofurence.Companion.Views.CollectionGamePlayerView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:Eurofurence.Companion.Views"
      xmlns:controls="using:Eurofurence.Companion.Views.Controls"
      xmlns:core="using:Microsoft.Xaml.Interactions.Core"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:interactivity="using:Microsoft.Xaml.Interactivity"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:media="using:Microsoft.Xaml.Interactions.Media"
      x:Name="self"
      mc:Ignorable="d"
      Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
      DataContext="{Binding Source={StaticResource ViewModelLocator}, Path=CollectionGamePlayerViewModel}">
    <Page.Resources>
        <Storyboard x:Key="FursuitImageExit">
            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="FursuitImage"
                                           Storyboard.TargetProperty="Opacity">
                <LinearDoubleKeyFrame Value="0"
                                      KeyTime="00:00:00.000" />
            </DoubleAnimationUsingKeyFrames>
        </Storyboard>
        
        <Storyboard x:Key="FursuitImageEntrance">
            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="FursuitImage"
                                           Storyboard.TargetProperty="Opacity">
                <LinearDoubleKeyFrame Value="0"
                                      KeyTime="00:00:00.000" />
                <LinearDoubleKeyFrame Value="1"
                                      KeyTime="00:00:01.000" />
            </DoubleAnimationUsingKeyFrames>
            
            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="FursuitImage"
                                           Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.ScaleX)">

                <LinearDoubleKeyFrame Value="0"
                                      KeyTime="00:00:00.000" />
                <EasingDoubleKeyFrame Value="1.4" KeyTime="00:00:01.000">
                    <EasingDoubleKeyFrame.EasingFunction>
                        <PowerEase EasingMode="EaseInOut" />
                    </EasingDoubleKeyFrame.EasingFunction>
                </EasingDoubleKeyFrame>
                <EasingDoubleKeyFrame Value="1"
                                      KeyTime="00:00:02.000">
                    <EasingDoubleKeyFrame.EasingFunction>
                        <PowerEase EasingMode="EaseInOut" />
                    </EasingDoubleKeyFrame.EasingFunction>
                </EasingDoubleKeyFrame>
            </DoubleAnimationUsingKeyFrames>

            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="FursuitImage"
                                           Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.ScaleY)">

                <LinearDoubleKeyFrame Value="0"
                                      KeyTime="00:00:00.000" />
                <EasingDoubleKeyFrame Value="1.4"
                                      KeyTime="00:00:01.000">
                    <EasingDoubleKeyFrame.EasingFunction>
                        <PowerEase EasingMode="EaseInOut" />
                    </EasingDoubleKeyFrame.EasingFunction>
                </EasingDoubleKeyFrame>
                <EasingDoubleKeyFrame Value="1"
                                      KeyTime="00:00:02.000">
                    <EasingDoubleKeyFrame.EasingFunction>
                        <PowerEase EasingMode="EaseInOut" />
                    </EasingDoubleKeyFrame.EasingFunction>
                </EasingDoubleKeyFrame>
            </DoubleAnimationUsingKeyFrames>

        </Storyboard>
        <Storyboard x:Key="Storyboard" RepeatBehavior="Forever" AutoReverse="True">
            <DoubleAnimation Storyboard.TargetName="StarInner"
                             Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.ScaleX)"
                             From="0.8"
                             To="1.2"
                             BeginTime="00:00:00.000"
                             Duration="00:00:02.000">
                <DoubleAnimation.EasingFunction>
                    <PowerEase EasingMode="EaseInOut" />
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetName="StarInner"
                             Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.ScaleY)"
                             From="0.8"
                             To="1.2"
                             BeginTime="00:00:00.000"
                             Duration="00:00:02.000">
                <DoubleAnimation.EasingFunction>
                    <PowerEase EasingMode="EaseInOut" />
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetName="StarOuter"
                             Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.ScaleX)"
                             From="1.2"
                             To="0.8"
                             BeginTime="00:00:00.000"
                             Duration="00:00:02.000">
                <DoubleAnimation.EasingFunction>
                    <PowerEase EasingMode="EaseInOut" />
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetName="StarOuter"
                             Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.ScaleY)"
                             From="1.2"
                             To="0.8"
                             BeginTime="00:00:00.000"
                             Duration="00:00:02.000">
                <DoubleAnimation.EasingFunction>
                    <PowerEase EasingMode="EaseInOut" />
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>            

        </Storyboard>
    </Page.Resources>

    <interactivity:Interaction.Behaviors>
        <interactivity:BehaviorCollection>
            <core:EventTriggerBehavior EventName="Loaded">
                <core:InvokeCommandAction Command="{Binding Load}" />
                <!--<media:ControlStoryboardAction Storyboard="{StaticResource Storyboard}" ControlStoryboardOption="Play" />-->
            </core:EventTriggerBehavior>
            <core:DataTriggerBehavior Binding="{Binding PageIndex}"
                                      Value="1">
                <media:ControlStoryboardAction Storyboard="{StaticResource FursuitImageExit}"
                                               ControlStoryboardOption="Play" />
                <media:ControlStoryboardAction Storyboard="{StaticResource Storyboard}"
                                               ControlStoryboardOption="Play" />
            </core:DataTriggerBehavior>
            <core:DataTriggerBehavior Binding="{Binding PageIndex}"
                                      Value="0">
                <media:ControlStoryboardAction Storyboard="{StaticResource Storyboard}"
                                               ControlStoryboardOption="Stop" />
                <media:ControlStoryboardAction Storyboard="{StaticResource FursuitImageEntrance}"
                                               ControlStoryboardOption="Stop" />
                <media:ControlStoryboardAction Storyboard="{StaticResource FursuitImageExit}"
                                               ControlStoryboardOption="Play" />
            </core:DataTriggerBehavior>
        </interactivity:BehaviorCollection>
        
    </interactivity:Interaction.Behaviors>

    <Grid x:Name="LayoutRoot">
        <Grid Visibility="{Binding IsBusy, Converter={StaticResource TrueToVisibleConverter}}">
            <controls:LoadingBoxControl />
        </Grid>
        <ScrollViewer Visibility="{Binding IsBusy, Converter={StaticResource FalseToVisibleConverter}}">
            <StackPanel Margin="20 10 20 10">

                <StackPanel Visibility="{Binding PageIndex, Converter={StaticResource ValueMatchToVisibilityConverter}, ConverterParameter=0}">

                    <!--<TextBlock Text="{Binding CollectionCount}" />-->
                    <TextBlock>One day, I'll be a sexy UI.</TextBlock>

                    <TextBox Text="{Binding TokenValue, Mode=TwoWay}"></TextBox>
                    <Button Command="{Binding SubmitTokenCommand}">Submit</Button>

                    <controls:ErrorMessageControl ErrorMessage="{Binding ErrorMessage}" />
                </StackPanel>

                <StackPanel Visibility="{Binding PageIndex, Converter={StaticResource ValueMatchToVisibilityConverter}, ConverterParameter=1}">

                        <Grid>
                            <TextBlock FontFamily="{StaticResource IconFontFamily}"
                                   x:Name="StarInner"
                                   Text="&#xE249;"
                                   FontSize="330"
                                       TextAlignment="Center"
                                   Width="330"
                                       Opacity="0.3"
                                       Height="330"
                                       RenderTransformOrigin="0.500,0.553">
                                <TextBlock.RenderTransform>
                                    <CompositeTransform TranslateY="-10"
                                                        ScaleX="1.2"
                                                        ScaleY="1.2" />
                                </TextBlock.RenderTransform>
                            </TextBlock>
                            <TextBlock FontFamily="{StaticResource IconFontFamily}"
                                       x:Name="StarOuter"
                                       Text="&#xE249;"
                                   FontSize="330"
                                       TextAlignment="Center"
                                   Width="330"
                                       Opacity="0.3"
                                       Height="330"
                                       RenderTransformOrigin="0.500,0.553">
                                <TextBlock.RenderTransform>
                                    <CompositeTransform TranslateY="-10"
                                                        ScaleX="0.8"
                                                        ScaleY="0.8" />
                                </TextBlock.RenderTransform>
                            </TextBlock>
                            <Border 
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Width="180" Height="240"
                                    >
                                <Image Source="{Binding Response.FursuitBadgeId, Converter={StaticResource FursuitBadgeIdToUriConverter}}"
                                       VerticalAlignment="Center"
                                       x:Name="FursuitImage"
                                   RenderTransformOrigin="0.5,0.5">
                                    <interactivity:Interaction.Behaviors>
                                        <interactivity:BehaviorCollection>
                                            <core:EventTriggerBehavior EventName="ImageOpened">
                                                <media:ControlStoryboardAction Storyboard="{StaticResource FursuitImageEntrance}"
                                                                               ControlStoryboardOption="Play" />
                                            </core:EventTriggerBehavior>
                                        </interactivity:BehaviorCollection>
                                    </interactivity:Interaction.Behaviors>
                                    <Image.RenderTransform>
                                        <CompositeTransform TranslateX="0" TranslateY="0" ScaleX="1" ScaleY="1" />
                                    </Image.RenderTransform>
                                </Image>
                            </Border>

                        </Grid>

                    <Border Background="#30000000"
                            Margin="-20 0 -20 0"
                            Padding="10">
                        <StackPanel >
                            <TextBlock TextAlignment="Center"
                                       Style="{StaticResource BodyTextBlockStyle}"
                                       >Congraulations! You found: </TextBlock>
                            <TextBlock TextAlignment="Center"
                                       FontWeight="ExtraBlack"
                                       Style="{StaticResource SubheaderTextBlockStyle}"
                                       Text="{Binding Response.Name}"
                                       Foreground="{StaticResource EurofurenceThemeColorBrush}"
                                       />
                            <TextBlock Style="{StaticResource BodyTextBlockStyle}"
                                       TextAlignment="Center">
                                <Run Text="{Binding Response.Species}" />
                                <Run Text=" - " />
                                <Run Text="{Binding Response.Gender}" />
                            </TextBlock>

                            <TextBlock TextAlignment="Center" Margin="0 5 0 0">
                                <Run Text="{Binding Response.Name}" />
                                <Run Text="has been found by" />
                                <Run Text="{Binding CollectionCount}" />
                                <Run Text="people so far!" />
                            </TextBlock>

                        </StackPanel>
                    </Border>

                    <Button  HorizontalAlignment="Center" Command="{Binding BackCommand}">Go back.</Button>

                </StackPanel>
            </StackPanel>

        </ScrollViewer>
    </Grid>
</Page>
